# Stat 585X: Week 1

Ian Lyttle

```{r prelim}
library(knitr)
library(plyr)
library(reshape2)

options(width = 100, str = strOptions(vec.len = 2))

opts_chunk$set(
  comment = NA, 
  tidy = FALSE, 
  fig.align = "center", 
  fig.width = 10, 
  fig.height = 6,
  dev = "png"
)
```

## Summary

Here are my short answers to the questions:

#### What does it mean to melt data?

This is process by which we obtain *molten* data.

In the context of a data frame, molten data are data where each row contains a single observation of a single variable.

#### Why cast it into different forms?

It is sometimes the case where molten data are more amenable to transformation, modeling, and visualization. 

It is also sometimes the case that cast data are easier for humans to read. 

#### Where would this be useful?

This might be useful in summarizing a dataset for a presentation. It might also be useful in case you want to transform data using values from different variables.

These answers are expanded-upon using a case study.

## Case study

Let's look at one of the example files from the lecture.

```{r}
temp.all <- read.table("data/9641C_201112_raw.avg")
dim(temp.all)

colnames(temp.all) <- 
  c("id", "jan", "feb", "mar", "apr", "may", "jun", 
    "jul", "aug", "sep", "oct", "nov", "dec", "ann")

head(temp.all)
```

Looking at the structure of the data (and doing a little googling on the file name), it looks like the year column is a combination of a station id and a year.

```{r}
temp_new <- mutate(
  temp.all,
  station_id = floor(id/10000),
  year = id %% 10000,
  id = NULL
)
```

### Melting

I can replace the NA values by first melting the data frame (but there are other ways to do this without having melted the data frame).

```{r}
temp_melt <- 
  melt(temp_new, id.vars = c("station_id", "year"), variable.name = "month")

head(temp_melt)
str(temp_melt)
summary(temp_melt)
```

In addition to treating the NA values, we should coerce `value` from character to double.

```{r}
temp_melt$value <- as.numeric(temp_melt$value)
temp_melt$value[temp_melt$value == -9999] <- NA

head(temp_melt)
```

### Casting

Cast form (where it was originally) might be useful for tabular presentation.

```{r}
temp_cast <- dcast(temp_melt, formula = station_id + year ~ month)
head(temp_cast)
```

Also, maybe we are interested in, for each station and year, the difference between the value between June and October. Here, again, cast form is useful.

```{r}
temp_cast_diff <- summarize(
  temp_cast,
  station_id,
  year,
  oct_jun_diff = oct - jun
)

head(temp_cast_diff)
```

